<!-- Invoice Management UI -->
<div
  class="w-full mt-6 px-4 py-6 sm:px-6 lg:px-8 bg-white border border-blue-200 rounded-2xl shadow-md"
>
  <!-- Header Section -->
  <div
    class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4"
  >
    <h1
      class="text-2xl sm:text-3xl font-bold text-blue-900 flex items-center gap-2"
    >
      <i class="pi pi-file-invoice text-blue-600 text-xl sm:text-2xl"></i>
      Invoice Management
    </h1>
    <button
      pButton
      label="Add Invoice"
      icon="pi pi-plus"
      class="p-button-success p-button-rounded shadow-sm hover:scale-[1.03] transition"
      (click)="goToAdd()"
    ></button>
  </div>

  <!-- Filters Section -->
  <div
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 bg-blue-50 p-5 rounded-xl border border-blue-100 mb-6"
  >
    <!-- Company -->
    <div>
      <label for="company" class="block text-sm font-medium text-gray-700 mb-1"
        >Company</label
      >
      <p-dropdown
        inputId="company"
        [options]="companies"
        [(ngModel)]="selectedCompany"
        placeholder="Select Company"
        [showClear]="true"
        class="w-full"
      ></p-dropdown>
    </div>

    <!-- Show Filter -->
    <div>
      <label for="show" class="block text-sm font-medium text-gray-700 mb-1"
        >Show</label
      >
      <p-dropdown
        inputId="show"
        [options]="show"
        [(ngModel)]="selectedShow"
        placeholder="Filter"
        [showClear]="true"
        class="w-full"
      ></p-dropdown>
    </div>

    <!-- Search -->
    <div class="lg:col-span-2">
      <label for="search" class="block text-sm font-medium text-gray-700 mb-1"
        >Search</label
      >
      <div class="flex flex-col sm:flex-row items-stretch gap-2">
        <span class="p-input-icon-left w-full">
          <input
            id="search"
            pInputText
            type="text"
            [(ngModel)]="searchText"
            placeholder="Search by invoice no, party, city..."
            class="w-full"
          />
        </span>
        <div class="flex gap-2">
          <button
            pButton
            icon="pi pi-search"
            class="p-button-sm p-button-info p-button-rounded"
            (click)="searchInvoices()"
            pTooltip="Search"
          ></button>
          <button
            pButton
            icon="pi pi-refresh"
            class="p-button-sm p-button-secondary p-button-rounded"
            (click)="resetFilters()"
            pTooltip="Reset Filters"
          ></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Invoice Table -->
  <div class="overflow-x-auto">
    <p-table
      #table
      [value]="invoices"
      [loading]="tableLading"
      [paginator]="true"
      [rows]="dataCount"
      [responsiveLayout]="'scroll'"
      [showGridlines]="true"
      [stripedRows]="true"
      [scrollable]="true"
      scrollHeight="flex"
      scrollDirection="both"
      [totalRecords]="totalRecords"
      (onLazyLoad)="loadData($event)"
      [lazy]="isLazyLoad"
      class="p-datatable-sm text-sm font-sans"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    >
      <ng-template pTemplate="header">
        <tr class="bg-blue-100 text-blue-900 text-sm font-semibold">
          <th pResizableColumn>Sl. No.</th>
          <th pResizableColumn>Branch</th>
          <th pResizableColumn>Invoice No.</th>
          <th pResizableColumn>Date</th>
          <th pResizableColumn>Party</th>
          <th pResizableColumn>City</th>
          <th pResizableColumn>Gross</th>
          <th pResizableColumn>Taxable</th>
          <th pResizableColumn>CGST</th>
          <th pResizableColumn>SGST</th>
          <th pResizableColumn>IGST</th>
          <th pResizableColumn>Non-Taxable</th>
          <th pResizableColumn>Net</th>
          <th pResizableColumn>Received</th>
          <th pResizableColumn>Due</th>
          <th class="text-center">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-invoice let-rowIndex="rowIndex">
        <tr class="text-gray-800 hover:bg-blue-50 transition text-sm">
          <td>{{ (table.first || 0) + rowIndex + 1 }}</td>
          <!-- Replace static slNo with calculated serial number -->
          <td>{{ invoice.branch }}</td>
          <td>{{ invoice.BillNo }}</td>
          <td>{{ invoice.BillDate }}</td>
          <td>{{ invoice.party_name || invoice.Duty_Type }}</td>
          <td>{{ invoice.City }}</td>
          <td>{{ invoice.GrossAmount }}</td>
          <td>
            <p-tag
              [value]="invoice.OtherCharges ?? '0'"
              severity="info"
            ></p-tag>
          </td>
          <td>{{ invoice.CGST }}</td>
          <td>{{ invoice.SGST }}</td>
          <td>{{ invoice.IGST }}</td>
          <td>
            <p-tag
              [value]="invoice.OtherCharges2 ?? '0'"
              severity="success"
            ></p-tag>
          </td>
          <td>{{ invoice.NetAmount }}</td>
          <td>
            <p-tag [value]="invoice.Advance ?? '0'" severity="warning"></p-tag>
          </td>
          <td>
            <p-tag
              [value]="
                ((invoice.NetAmount || 0) - (invoice.Advance || 0)).toString()
              "
              severity="danger"
            ></p-tag>
          </td>
          <td>
            <div class="flex justify-center gap-2">
              <button
                pButton
                icon="pi pi-eye"
                class="p-button-sm p-button-rounded p-button-info"
              ></button>
              <button
                pButton
                icon="pi pi-pencil"
                class="p-button-sm p-button-rounded p-button-warning"
              ></button>
              <button
                pButton
                icon="pi pi-trash"
                class="p-button-sm p-button-rounded p-button-danger"
              ></button>
              <button
                pButton
                icon="pi pi-wallet"
                class="p-button-sm p-button-rounded p-button-success"
              ></button>
              <button
                pButton
                icon="pi pi-code"
                class="p-button-sm p-button-rounded p-button-secondary"
              ></button>
              <button
                pButton
                icon="pi pi-file-pdf"
                class="p-button-sm p-button-rounded p-button-help"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>



