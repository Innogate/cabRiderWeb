<!-- Add full booking -->
<div *ngIf="isFullBooking && fullBookingFrom" class="flex justify-center">
  <div class="p-6 m-6 rounded-2xl shadow-xl border border-blue-300 bg-gradient-to-r from-white to-blue-50">
    <div class="flex items-center justify-between mb-6">
      <!-- Heading -->
      <h2 class="text-4xl font-extrabold text-blue-600 flex items-center gap-3 m-0">
        <i class="pi pi-calendar-plus text-blue-700 text-3xl"></i>
        Add Full Booking Information
      </h2>

      <!-- Toggle Button -->
      <div class="flex items-center gap-3">
        <p-toggleButton [(ngModel)]="isFullBooking" onLabel="fullBooking" offLabel="Booking" onIcon="pi-check-square"
          offIcon="pi pi-box" styleClass="w-48 h-10"></p-toggleButton>
      </div>
    </div>

    <form [formGroup]="fullBookingFrom">
      <div class="grid grid-cols-3 gap-6 mb-8 bg-white p-6 rounded-xl shadow-md">
        <!-- Branch -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-building text-xl text-blue-700"></i> Branch
          </label>

          <p-autoComplete [(ngModel)]="booking.branch" name="branch" [suggestions]="filteredBranches"
            (completeMethod)="filterBranches($event)" field="branch_name" [dropdown]="true" [forceSelection]="true"
            placeholder="Select Branch *" class="w-full" inputStyleClass="w-full" panelStyleClass="w-full">
            <!-- ðŸ‘‡ Custom Template for Suggestions -->
            <ng-template let-branch pTemplate="item">
              {{ branch.branch_name }} - {{ branch.city }}, {{ branch.state }}
            </ng-template>

            <!-- ðŸ‘‡ Optional: Custom Template for Selected Item -->
            <ng-template let-branch pTemplate="selectedItem">
              {{ branch.branch_name }}
            </ng-template>
          </p-autoComplete>
        </div>

        <!-- Slip No -->
        <div class="flex flex-col gap-2">
          <label class="font-medium flex text-gray-700 items-center gap-2">
            <i class="pi pi-file text-xl text-green-700"></i> Slip No
          </label>
          <input type="text" pInputText [(ngModel)]="booking.slipNo" name="slipNo" placeholder="Slip No *"
            class="w-full" readonly="true" />
        </div>

        <!-- Rental Date -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-calendar text-xl text-purple-700"></i> Rental Date
          </label>
          <input type="date" [(ngModel)]="booking.RentalDate" name="RentalDate" class="w-full border rounded-lg p-2" />
        </div>

        <!-- Reporting Time -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-clock text-xl text-pink-700"></i> Reporting Time
          </label>
          <input type="text" pInputText [(ngModel)]="booking.ReportingDatetime" name="reportingTime"
            placeholder="Reporting Time *" class="w-full" />
        </div>

        <!-- Car Type Request -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-car text-xl text-orange-600"></i> Car Type Request
          </label>
          <p-autoComplete [(ngModel)]="booking.CarType" name="carTypeRequest" [suggestions]="filteredCarTypes"
            (completeMethod)="filterCarTypes($event)" field="car_type" [dropdown]="true" [forceSelection]="true"
            placeholder="Car Type Request *" class="w-full" inputStyleClass="w-full"
            panelStyleClass="w-full"></p-autoComplete>
        </div>

        <!-- Car Type Send -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-car text-xl text-cyan-700"></i> Car Type Send
          </label>
          <p-autoComplete [(ngModel)]="booking.carTypeSend" name="carTypeSend" [suggestions]="filteredCarTypeSend"
            (completeMethod)="filterCarTypeSend($event)" field="car_type" [dropdown]="true" [forceSelection]="true"
            placeholder="Car Type Send *" class="w-full" inputStyleClass="w-full"
            panelStyleClass="w-full"></p-autoComplete>
        </div>


        <!-- Car No -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-car text-xl text-yellow-700"></i> Car No
          </label>
          <input type="text" pInputText [(ngModel)]="booking.carNo" name="carNo" placeholder="Car No *"
            class="w-full" />
        </div>

        <!-- Driver -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-user text-xl text-blue-500"></i> Driver
          </label>
          <input type="text" pInputText [(ngModel)]="booking.driver" name="driver" placeholder="Driver"
            class="w-full" />
        </div>

        <!-- From City -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-map-marker text-xl text-purple-600"></i> From City
          </label>
          <p-autoComplete [(ngModel)]="booking.FromCityID" name="fromCity" [suggestions]="filteredCities"
            (completeMethod)="filterCities($event)" field="CityName" [dropdown]="true" [forceSelection]="true"
            placeholder="From City" class="w-full" inputStyleClass="w-full" panelStyleClass="w-full"></p-autoComplete>
        </div>

        <!-- To City -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-map text-xl text-green-600"></i> To City
          </label>
          <p-autoComplete [(ngModel)]="booking.toCity" name="toCity" [suggestions]="filteredToCities"
            (completeMethod)="filterToCities($event)" field="CityName" [dropdown]="true" [forceSelection]="true"
            placeholder="To City *" class="w-full" inputStyleClass="w-full" panelStyleClass="w-full"></p-autoComplete>
        </div>

        <!-- Party -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-users text-xl text-pink-500"></i> Party
          </label>
          <p-autoComplete [(ngModel)]="booking.Party" name="Party" [suggestions]="PartyName"
            (completeMethod)="filterPartyName($event)" field="name" placeholder="Party *"
            class="w-full"></p-autoComplete>
        </div>

        <!-- Project -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-briefcase text-xl text-cyan-500"></i> Project
          </label>
          <input type="text" pInputText [(ngModel)]="booking.Project" name="Project" placeholder="Project"
            class="w-full" />
        </div>

        <!-- Booked By -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-user-plus text-xl text-yellow-500"></i> Booked By
          </label>
          <input type="text" pInputText [(ngModel)]="booking.BookedBy" name="BookedBy" placeholder="Booked By"
            class="w-full" />
        </div>

        <!-- Vendor -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-briefcase text-xl text-purple-500"></i> Vendor
          </label>
          <p-autoComplete [(ngModel)]="booking.vendor" name="vendor" [suggestions]="filteredVendors"
            (completeMethod)="searchVendors($event)" field="name" placeholder="Vendor *"
            class="w-full"></p-autoComplete>
        </div>

        <!-- Duty Type -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-check-circle text-xl text-green-700"></i> Duty Type
          </label>
          <p-dropdown [(ngModel)]="booking.DutyType" name="dutyType" [options]="dutyTypes" optionLabel="name"
            placeholder="Duty Type *" class="w-full"></p-dropdown>
        </div>

        <!-- Contact No -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-phone text-xl text-blue-600"></i> Contact No
          </label>
          <input type="text" pInputText [(ngModel)]="booking.ContactNo" name="ContactNo" placeholder="Contact No"
            class="w-full" />
        </div>
      </div>

      <!-- Party & Vendor Rate Sections -->
      <div class="grid grid-cols-2 gap-6">
        <div class="bg-white p-2 rounded-xl shadow-md">
          <h3 class="text-xl font-semibold text-green-600 mb-4">
            Party Rate Details
          </h3>

          <!-- Party Rate Type and Select Rate -->
          <div class="grid grid-cols-3 gap-4 mb-6">
            <p-dropdown [(ngModel)]="booking.PartyRateType" [options]="partyRateTypes" optionLabel="label"
              optionValue="value" placeholder="Party Rate Type *" class="w-full"
              (onChange)="changePartyRateType()"></p-dropdown>

            <p-dropdown [(ngModel)]="booking.selectRate" name="selectRate" [options]="selectRates"
              optionLabel="party_name" optionValue="id" placeholder="Select Rate *" class="w-full"></p-dropdown>

            <button pButton type="button" label="Get Price" class="p-button-success w-full"></button>
          </div>

          <!-- Main Section: Date/Time & Cash Side by Side -->
          <div class="grid grid-cols-3 gap-6">
            <!-- Date & KM Section -->
            <div class="col-span-2 grid grid-cols-2 gap-4">
              <ng-container *ngFor="let field of dateFields">
                <div>
                  <label class="font-medium">{{ field.label }}</label>
                  <input type="datetime-local" [(ngModel)]="booking[field.dateModel]" name="{{ field.dateModel }}"
                    class="w-full border border-gray-300 p-2 rounded" (change)="calculateTotals()" />
                </div>

                <div>
                  <label class="font-medium">{{ field.kmLabel }}</label>
                  <input type="number" pInputText [(ngModel)]="booking[field.kmModel]" name="{{ field.kmModel }}"
                    class="w-full border border-gray-300 p-2 rounded" (input)="calculateTotals()" />
                </div>
              </ng-container>
            </div>

            <!-- Cash Section -->
            <div class="border border-gray-300 p-1 rounded h-fit">
              <table class="w-full text-left">
                <tbody>
                  <tr class="border-b border-gray-300">
                    <td class="p-2 font-medium">Cash</td>
                    <td class="p-2">
                      <p-checkbox [(ngModel)]="booking.cash" binary="true" name="cash"></p-checkbox>
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300 bg-gray-200">
                    <td class="font-medium">KM Rate</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="booking.KMRate" name="KMRate" class="w-full"
                        (input)="calculateTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="font-medium">Hour Rate</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="booking.HourRate" name="HourRate" class="w-full"
                        (input)="calculateTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="font-medium">Price</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="booking.Price" name="Price" class="w-full"
                        (input)="calculateTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="font-medium">Advance</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="booking.Advance" name="Advance" class="w-full"
                        (input)="calculateTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="p-2 font-medium">Net Amount</td>
                    <td class="p-2 text-center">{{ booking.netAmount || 0 }}</td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="p-2 font-medium">Other Charges</td>
                    <td class="p-2 text-center">
                      {{ booking.otherCharges || 0 }}
                    </td>
                  </tr>

                  <tr>
                    <td class="p-2 font-medium">Total Amount</td>
                    <td class="p-2 text-center font-semibold text-green-600">
                      {{ booking.totalAmount || 0 }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Summary -->
          <div class="mt-4 grid grid-cols-2 gap-4">
            <div class="text-gray-700 font-medium">
              Total Hours: {{ totalHours }}
            </div>
            <div class="text-gray-700 font-medium">Total KM: {{ totalKM }}</div>
          </div>

          <!-- Extra Charges -->
          <div class="mt-6">
            <table class="w-full text-center border border-green-700">
              <thead class="bg-green-700 text-white">
                <tr>
                  <th class="p-2"></th>
                  <th class="p-2">Rate</th>
                  <th class="p-2">Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="p-2">Extra Hour
                    <input type="number" pInputText [(ngModel)]="booking.extraHour" name="extraHour" class="w-full" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="booking.extraHourRate" name="extraHourRate"
                      class="w-full" (input)="calculateTotals()" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="booking.extraHourAmount" name="extraHourAmount"
                      class="w-full" (input)="calculateTotals()" />
                  </td>
                </tr>
                <tr>
                  <td class="p-2">Extra KM
                    <input type="number" pInputText [(ngModel)]="booking.extraKm" name="extraKm" class="w-full" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="booking.extraKmRate" name="extraKmRate" class="w-full"
                      (input)="calculateTotals()" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="booking.extraKmAmount" name="extraKmAmount"
                      class="w-full" (input)="calculateTotals()" />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Charges Table -->
          <div class="mt-6">
            <table class="w-full text-center border border-green-700">
              <thead class="bg-green-700 text-white">
                <tr>
                  <th class="p-2">
                    Charges Name <span class="text-red-500">*</span>
                  </th>
                  <th class="p-2">Amount</th>
                  <th class="p-2">Image</th>
                  <th class="p-2">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let charge of charges; let i = index">
                  <td class="p-2">
                    <input type="text" pInputText [(ngModel)]="charge.name" [name]="'chargeName' + i" class="w-full" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="charge.amount" [name]="'chargeAmount' + i"
                      class="w-full" (input)="calculateTotals()" />
                  </td>
                  <td class="p-2">
                    <input type="file" (change)="onFileSelected($event, i)" />
                  </td>
                  <td class="p-2">
                    <button pButton type="button" icon="pi pi-trash" class="p-button-danger"
                      (click)="removeCharge(i)"></button>
                  </td>
                </tr>
              </tbody>
            </table>
            <button pButton type="button" icon="pi pi-plus" class="mt-4 p-button-success"
              (click)="addCharge()"></button>
          </div>
        </div>

        <!-- Vendor Rate Section -->
        <div class="bg-white p-2 rounded-xl shadow-md">
          <h3 class="text-xl font-semibold text-blue-600 mb-4">
            Vendor Rate Details
          </h3>

          <!-- Vendor Rate Type and Select Rate -->
          <div class="grid grid-cols-3 gap-4 mb-6">
            <p-dropdown [(ngModel)]="vendorBooking.vendorRateType" name="vendorRateType" [options]="vendorRateTypes"
              optionLabel="name" placeholder="Vendor Rate Type *" class="w-full"></p-dropdown>

            <p-dropdown [(ngModel)]="vendorBooking.selectedRate" name="selectRate" [options]="selectRates"
              optionLabel="name" placeholder="Select Rate *" class="w-full"></p-dropdown>

            <button pButton type="button" label="Get Price" class="p-button-success w-full"></button>
          </div>

          <!-- Main Section: Date/Time & Cash Side by Side -->
          <div class="grid grid-cols-3 gap-6">
            <!-- Date & KM Section -->
            <div class="col-span-2 grid grid-cols-2 gap-4">
              <ng-container *ngFor="let field of vendorDateFields">
                <div>
                  <label class="font-medium">{{ field.label }}</label>
                  <input type="datetime-local" [(ngModel)]="booking[field.dateModel]" name="{{ field.dateModel }}"
                    class="w-full border border-gray-300 p-2 rounded" (change)="calculateVendorTotals()" />
                </div>

                <div>
                  <label class="font-medium">{{ field.kmLabel }}</label>
                  <input type="number" pInputText [(ngModel)]="booking[field.kmModel]" name="{{ field.kmModel }}"
                    class="w-full border border-gray-300 p-2 rounded" (input)="calculateVendorTotals()" />
                </div>
              </ng-container>
            </div>

            <!-- Cash Section -->
            <div class="border border-gray-300 p-1 rounded h-fit">
              <table class="w-full text-left">
                <tbody>
                  <tr class="border-b border-gray-300">
                    <td class="p-2 font-medium">Cash</td>
                    <td class="p-2">
                      <p-checkbox [(ngModel)]="vendorBooking.cash" binary="true" name="cash"></p-checkbox>
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300 bg-gray-200">
                    <td class="font-medium">KM Rate</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="vendorBooking.kmRate" name="kmRate" class="w-full"
                        (input)="calculateVendorTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="font-medium">Hour Rate</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="vendorBooking.hourRate" name="hourRate"
                        class="w-full" (input)="calculateVendorTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="font-medium">Price</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="vendorBooking.price" name="price" class="w-full"
                        (input)="calculateVendorTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="font-medium">Advance</td>
                    <td class="">
                      <input type="number" pInputText [(ngModel)]="vendorBooking.advance" name="advance" class="w-full"
                        (input)="calculateVendorTotals()" />
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="p-2 font-medium">Net Amount</td>
                    <td class="p-2 text-center">
                      {{ vendorBooking.netAmount || 0 }}
                    </td>
                  </tr>

                  <tr class="border-b border-gray-300">
                    <td class="p-2 font-medium">Other Charges</td>
                    <td class="p-2 text-center">
                      {{ vendorBooking.otherCharges || 0 }}
                    </td>
                  </tr>

                  <tr>
                    <td class="p-2 font-medium">Total Amount</td>
                    <td class="p-2 text-center font-semibold text-blue-600">
                      {{ vendorBooking.totalAmount || 0 }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Summary -->
          <div class="mt-4 grid grid-cols-2 gap-4">
            <div class="text-gray-700 font-medium">
              Total Hours: {{ totalVendorHours }}
            </div>
            <div class="text-gray-700 font-medium">
              Total KM: {{ totalVendorKM }}
            </div>
          </div>

          <!-- Extra Charges -->
          <div class="mt-6">
            <table class="w-full text-center border border-blue-700">
              <thead class="bg-blue-700 text-white">
                <tr>
                  <th class="p-2"></th>
                  <th class="p-2">Rate</th>
                  <th class="p-2">Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="p-2">Extra Hour
                    <input type="number" pInputText [(ngModel)]="booking.extraHour" name="extraKm" class="w-full" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="vendorBooking.extraHourRate" name="extraHourRate"
                      class="w-full" (input)="calculateVendorTotals()" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="vendorBooking.extraHourAmount" name="extraHourAmount"
                      class="w-full" (input)="calculateVendorTotals()" />
                  </td>
                </tr>
                <tr>
                  <td class="p-2">Extra KM
                    <input type="number" pInputText [(ngModel)]="booking.extraKm" name="extraKm" class="w-full" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="vendorBooking.extraKmRate" name="extraKmRate"
                      class="w-full" (input)="calculateVendorTotals()" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="vendorBooking.extraKmAmount" name="extraKmAmount"
                      class="w-full" (input)="calculateVendorTotals()" />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Additional Charges Table -->
          <div class="mt-6">
            <table class="w-full text-center border border-blue-700">
              <thead class="bg-blue-700 text-white">
                <tr>
                  <th class="p-2">
                    Charges Name <span class="text-red-500">*</span>
                  </th>
                  <th class="p-2">Amount</th>
                  <th class="p-2">Image</th>
                  <th class="p-2">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let charge of vendorCharges; let i = index">
                  <td class="p-2">
                    <input type="text" pInputText [(ngModel)]="charge.name" [name]="'chargeName' + i" class="w-full" />
                  </td>
                  <td class="p-2">
                    <input type="number" pInputText [(ngModel)]="charge.amount" [name]="'chargeAmount' + i"
                      class="w-full" (input)="calculateVendorTotals()" />
                  </td>
                  <td class="p-2">
                    <input type="file" (change)="onVendorFileSelected($event, i)" />
                  </td>
                  <td class="p-2">
                    <button pButton type="button" icon="pi pi-trash" class="p-button-danger"
                      (click)="removeVendorCharge(i)"></button>
                  </td>
                </tr>
              </tbody>
            </table>
            <button pButton type="button" icon="pi pi-plus" class="mt-4 p-button-success"
              (click)="addVendorCharge()"></button>
          </div>
        </div>
      </div>
    </form>

    <!-- Guest Section -->
    <p-tabView>
      <!-- Guest Name Tab -->
      <p-tabPanel header="Guest Name">
        <div class="mt-4 bg-white p-4 rounded-xl shadow-md">
          <h3 class="text-xl font-semibold text-purple-600 mb-4">
            Guest Details
          </h3>
          <p-table [value]="guests" responsiveLayout="scroll">
            <ng-template pTemplate="header">
              <tr>
                <th>Guest Name *</th>
                <th>Contact No *</th>
                <th>Additional Contact No *</th>
                <th>Pickup Address *</th>
                <th>Drop Address *</th>
                <th>Remarks</th>
                <th>Action</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-guest let-i="rowIndex">
              <tr>
                <td>
                  <input type="text" pInputText [(ngModel)]="guest.name" name="guestName{{ i }}" class="w-full"
                    placeholder="Guest Name" />
                </td>
                <td>
                  <input type="text" pInputText [(ngModel)]="guest.contactNo" name="contactNo{{ i }}" class="w-full"
                    placeholder="Contact No" />
                </td>
                <td>
                  <input type="text" pInputText [(ngModel)]="guest.additionalContactNo"
                    name="additionalContactNo{{ i }}" class="w-full" placeholder="Additional Contact No" />
                </td>
                <td>
                  <textarea pInputTextarea [(ngModel)]="guest.pickupAddress" name="pickupAddress{{ i }}"
                    class="w-full p-inputtext" placeholder="Pickup Address"></textarea>
                </td>
                <td>
                  <textarea pInputTextarea [(ngModel)]="guest.dropAddress" name="dropAddress{{ i }}"
                    class="w-full p-inputtext" placeholder="Drop Address"></textarea>
                </td>
                <td>
                  <textarea pInputTextarea [(ngModel)]="guest.remarks" name="remarks{{ i }}" class="w-full p-inputtext"
                    placeholder="Remarks"></textarea>
                </td>
                <td class="text-center">
                  <button pButton icon="pi pi-trash" class="p-button-danger" (click)="removeGuest(i)"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button pButton type="button" label="Add Guest" icon="pi pi-plus" class="mt-4 p-button-success"
            (click)="addGuest()"></button>
        </div>
      </p-tabPanel>

      <!-- Others Tab -->
      <p-tabPanel header="Others">
        <div class="mt-4 bg-white p-4 rounded-xl shadow-md grid grid-cols-3 gap-4">
          <div>
            <label class="font-medium">Report At</label>
            <p-dropdown [options]="reportOptions" [(ngModel)]="others.reportAt" name="reportAt"
              placeholder="Select option" class="w-full"></p-dropdown>
          </div>

          <div>
            <label class="font-medium">Booking Mode</label>
            <p-dropdown [options]="bookingModes" [(ngModel)]="others.bookingMode" name="bookingMode"
              placeholder="Select option" class="w-full"></p-dropdown>
          </div>

          <div>
            <label class="font-medium">Bill To</label>
            <p-dropdown [options]="billToOptions" [(ngModel)]="others.billTo" name="billTo" placeholder="Bill To"
              class="w-full"></p-dropdown>
          </div>

          <div>
            <label class="font-medium">Email</label>
            <input type="email" pInputText [(ngModel)]="others.email" name="email" class="w-full" placeholder="Email" />
          </div>

          <div>
            <label class="font-medium">Booked By Email</label>
            <input type="email" pInputText [(ngModel)]="others.bookedByEmail" name="bookedByEmail" class="w-full"
              placeholder="Booked By Email" />
          </div>

          <div>
            <label class="font-medium">Flight / Train No</label>
            <input type="text" pInputText [(ngModel)]="others.flightTrainNo" name="flightTrainNo" class="w-full"
              placeholder="Flight / Train No" />
          </div>

          <div>
            <label class="font-medium">Drop At</label>
            <input type="text" pInputText [(ngModel)]="others.dropAt" name="dropAt" class="w-full"
              placeholder="Drop At" />
          </div>

          <div>
            <label class="font-medium">Report At</label>
            <input type="text" pInputText [(ngModel)]="others.otherReportAt" name="otherReportAt" class="w-full"
              placeholder="Report At" />
          </div>

          <div>
            <label class="font-medium">Release At</label>
            <input type="text" pInputText [(ngModel)]="others.releaseAt" name="releaseAt" class="w-full"
              placeholder="Release At" />
          </div>

          <div>
            <label class="font-medium">Attach Duty Slip</label>
            <input type="file" (change)="onFileSelectedGuest($event)" class="w-full" />
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>

    <!-- Action Buttons -->
    <div class="flex justify-end mt-6 gap-4">
      <button pButton type="button" label="Close" class="p-button-secondary"></button>
      <button pButton type="button" label="Save" class="p-button-success" (click)="saveBooking()"></button>
    </div>
  </div>
</div>





<!-- Add Booking-->
<div *ngIf="!isFullBooking && bookingFrom"
  class="p-6 m-6 rounded-2xl shadow-xl border border-blue-300 bg-gradient-to-r from-white to-blue-50">
  <div class="flex items-center justify-between mb-6">
    <!-- Heading -->
    <h2 class="text-4xl font-extrabold text-blue-600 flex items-center gap-3 m-0">
      <i class="pi pi-calendar-plus text-blue-700 text-3xl"></i>
      Add Booking Information
    </h2>

    <!-- Toggle Button -->
    <div class="flex items-center gap-3">
      <p-toggleButton [(ngModel)]="booking.fullBooking" onLabel="fullBooking" offLabel="Booking"
        onIcon="pi-check-square" offIcon="pi pi-clone" styleClass="w-48 h-10"></p-toggleButton>
    </div>
  </div>


  <form [formGroup]="bookingFrom">
    <!-- Booking Section -->
    <div class="p-6 m-6 rounded-2xl bg-gradient-to-r from-white to-blue-50">
      <div class="grid grid-cols-3 gap-6 mb-8 bg-white p-6 rounded-xl shadow-md">
        <!-- Branch -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-building text-xl text-blue-700"></i> Branch
          </label>

          <p-autoComplete formControlName="branch_id" (onSelect)="onBranchSelect($event)" name="branch" [suggestions]="filteredBranches"
            (completeMethod)="filterBranches($event)" field="branch_name" [dropdown]="true" [forceSelection]="true"
            placeholder="Select Branch *" class="w-full" inputStyleClass="w-full" panelStyleClass="w-full">
            <!-- ðŸ‘‡ Custom Template for Suggestions -->
            <ng-template let-branch pTemplate="item">
              {{ branch.branch_name }} - {{ branch.city }}, {{ branch.state }}
            </ng-template>

            <!-- ðŸ‘‡ Optional: Custom Template for Selected Item -->
            <ng-template let-branch pTemplate="selectedItem">
              {{ branch.branch_name }}
            </ng-template>
          </p-autoComplete>
        </div>


        <!-- Slip No -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-file-edit text-xl text-green-600"></i> Slip No
          </label>
          <input type="text" pInputText [(ngModel)]="booking.slipNo" placeholder="Slip No *" class="w-full"
            readonly="true" />
        </div>

        <!-- Rental Date -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-calendar text-xl text-purple-600"></i> Rental Date
          </label>
          <input type="date" [(ngModel)]="booking.RentalDate" class="w-full p-2 border rounded-lg" />
        </div>

        <!-- Reporting Time -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-clock text-xl text-pink-600"></i> Reporting Time
          </label>
          <input type="text" pInputText [(ngModel)]="booking.ReportingDatetime" placeholder="Reporting Time *"
            class="w-full" />
        </div>

        <!-- Car Type Request -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-car text-xl text-orange-600"></i> Car Type Request
          </label>
          <p-autoComplete [(ngModel)]="booking.CarType" name="carTypeRequest" [suggestions]="filteredCarTypes"
            (completeMethod)="filterCarTypes($event)" field="car_type" [dropdown]="true" [forceSelection]="true"
            placeholder="Car Type Request *" class="w-full" inputStyleClass="w-full"
            panelStyleClass="w-full"></p-autoComplete>
        </div>


        <!-- Car Type Send -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-car text-xl text-cyan-700"></i> Car Type Send
          </label>
          <p-autoComplete [(ngModel)]="booking.carTypeSend" name="carTypeSend" [suggestions]="filteredCarTypeSend"
            (completeMethod)="filterCarTypeSend($event)" field="car_type" [dropdown]="true" [forceSelection]="true"
            placeholder="Car Type Send *" class="w-full" inputStyleClass="w-full"
            panelStyleClass="w-full"></p-autoComplete>
        </div>

        <!-- Car No -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-id-card text-xl text-yellow-600"></i> Car No
          </label>
          <input type="text" pInputText [(ngModel)]="booking.carNo" placeholder="Car No *" class="w-full" />
        </div>

        <!-- Driver -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-user text-xl text-blue-600"></i> Driver
          </label>
          <input type="text" pInputText [(ngModel)]="booking.driver" placeholder="Driver" class="w-full" />
        </div>

        <!-- From City -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-map-marker text-xl text-purple-600"></i> From City
          </label>
          <p-autoComplete [(ngModel)]="booking.FromCityID" name="fromCity" [suggestions]="filteredCities"
            (completeMethod)="filterCities($event)" field="CityName" [dropdown]="true" [forceSelection]="true"
            placeholder="From City" class="w-full" inputStyleClass="w-full" panelStyleClass="w-full"></p-autoComplete>
        </div>



        <!-- To City -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-map text-xl text-green-600"></i> To City
          </label>
          <p-autoComplete [(ngModel)]="booking.toCity" name="toCity" [suggestions]="filteredToCities"
            (completeMethod)="filterToCities($event)" field="CityName" [dropdown]="true" [forceSelection]="true"
            placeholder="To City *" class="w-full" inputStyleClass="w-full" panelStyleClass="w-full"></p-autoComplete>
        </div>


        <!-- Party -->
        <div class="flex flex-col gap-2">
          <label class="font-medium text-gray-700 flex items-center gap-2">
            <i class="pi pi-users text-xl text-pink-500"></i> Party
          </label>
          <p-autoComplete [(ngModel)]="booking.Party" name="Party" [suggestions]="PartyName"
            (completeMethod)="filterPartyName($event)" field="name" placeholder="Party *"
            class="w-full"></p-autoComplete>
        </div>

        <!-- Project -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-briefcase text-xl text-cyan-600"></i> Project
          </label>
          <input type="text" pInputText [(ngModel)]="booking.Project" placeholder="Project" class="w-full" />
        </div>

        <!-- Booked By -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-user-plus text-xl text-yellow-600"></i> Booked By
          </label>
          <input type="text" pInputText [(ngModel)]="booking.BookedBy" placeholder="Booked By" class="w-full" />
        </div>

        <!-- Vendor -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-building text-xl text-purple-700"></i> Vendor
          </label>
          <p-autoComplete [(ngModel)]="booking.vendor" [suggestions]="filteredVendors"
            (completeMethod)="searchVendors($event)" field="name" placeholder="Vendor *"
            class="w-full"></p-autoComplete>
        </div>

        <!-- Duty Type -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-check-circle text-xl text-green-700"></i> Duty Type
          </label>
          <p-dropdown [(ngModel)]="booking.DutyType" [options]="dutyTypes" optionLabel="name" placeholder="Duty Type *"
            class="w-full"></p-dropdown>
        </div>

        <!-- Contact No -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-phone text-xl text-blue-600"></i> Contact No
          </label>
          <input type="text" pInputText [(ngModel)]="booking.ContactNo" placeholder="Contact No" class="w-full" />
        </div>

        <!-- Email -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-envelope text-xl text-blue-600"></i> Email
          </label>
          <input type="email" pInputText [(ngModel)]="booking.Email" placeholder="Email" class="w-full" />
        </div>

        <!-- Booked by Email -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-envelope text-xl text-blue-600"></i> Booked By Email
          </label>
          <input type="email" pInputText [(ngModel)]="others.bookedByEmail" placeholder="Booked By Email"
            class="w-full" />
        </div>

        <!-- Party Rate Type -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-money-bill text-xl text-blue-600"></i> Party Rate Type
          </label>
          <p-dropdown [(ngModel)]="booking.PartyRateType" [options]="partyRateTypes" optionLabel="label"
            optionValue="value" placeholder="Party Rate Type *" class="w-full"
            (onChange)="changePartyRateType()"></p-dropdown>
        </div>

        <!-- Select Rate -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-percentage text-xl text-blue-600"></i> Select Rate
          </label>
          <p-dropdown [(ngModel)]="booking.selectRate" [options]="selectRates" optionLabel="name"
            placeholder="Select Rate *" class="w-full"></p-dropdown>
        </div>

        <!-- Drop At -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-map-marker-plus text-xl text-blue-600"></i> Drop At
          </label>
          <p-dropdown [(ngModel)]="booking.dropAt" [options]="dropAt" optionLabel="name" placeholder="Drop At"
            class="w-full"></p-dropdown>
        </div>

        <!-- Booking Mode -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-directions text-xl text-blue-600"></i> Booking Mode
          </label>
          <input type="text" pInputText [(ngModel)]="booking.BookingModes" placeholder="Booking Mode" class="w-full" />
        </div>

        <!-- Travel Mode -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-send text-xl text-blue-600"></i> Flight/Train
          </label>
          <input type="text" pInputText [(ngModel)]="booking.Flight_train_No" placeholder="Train/Flight"
            class="w-full" />
        </div>

        <!-- Entry Date -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-calendar-times text-xl text-blue-600"></i> Entry Date
          </label>
          <input type="date" pInputText [(ngModel)]="booking.EntryDate" placeholder="Entry Date" class="w-full" />
        </div>

        <!-- Entry Time -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-clock text-xl text-blue-600"></i> Entry Time
          </label>
          <input type="text" pInputText [(ngModel)]="booking.EntryTime" placeholder="Entry Time" class="w-full"
            readonly />

        </div>


        <!-- Cash & Advanced -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-wallet text-xl text-blue-600"></i> Payment
          </label>
          <div class="flex items-center gap-4">
            <p-checkbox [(ngModel)]="booking.cash" binary="true" inputId="cash"></p-checkbox>
            <label for="cash" class="text-gray-800 text-sm font-medium">Cash</label>
            <input type="text" pInputText [(ngModel)]="booking.Advanced" placeholder="Advanced" class="w-full" />
          </div>
        </div>

        <!-- Price -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-dollar text-xl text-blue-600"></i> Price
          </label>
          <input type="text" pInputText [(ngModel)]="booking.Price" placeholder="Price" class="w-full" />
        </div>

        <!-- Hour Rate -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-stopwatch text-xl text-blue-600"></i> Hour Rate
          </label>
          <input type="text" pInputText [(ngModel)]="booking.HourRate" placeholder="Hour Rate" class="w-full" />
        </div>

        <!-- KM Rate -->
        <div class="flex flex-col gap-2">
          <label class="font-semibold text-gray-800 flex items-center gap-2">
            <i class="pi pi-compass text-xl text-blue-600"></i> KM Rate
          </label>
          <input type="text" pInputText [(ngModel)]="booking.KmRate" placeholder="KM Rate" class="w-full" />
        </div>
      </div>

      <!-- Summary -->
      <div class="mt-6 grid grid-cols-3 gap-4 text-gray-800 text-lg font-semibold px-4">
        <div>Min Hours: {{ totalHours }}</div>
        <div>Night Halt Time: {{ totalKM }}</div>
        <div>Night Halt Amount: {{ totalKM }}</div>
      </div>
    </div>
  </form>

  <!-- Guest section -->
  <div class="mt-4 bg-white p-4 rounded-xl">
    <h3 class="text-xl font-semibold text-purple-600 mb-4">Guest Details</h3>
    <p-table [value]="guests" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Guest Name *</th>
          <th>Contact No *</th>
          <th>Additional Contact No *</th>
          <th>Pickup Address *</th>
          <th>Drop Address *</th>
          <th>Remarks</th>
          <th>Action</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-guest let-i="rowIndex">
        <tr>
          <td>
            <input type="text" pInputText [(ngModel)]="guest.name" name="guestName{{ i }}" class="w-full"
              placeholder="Guest Name" />
          </td>
          <td>
            <input type="text" pInputText [(ngModel)]="guest.contactNo" name="contactNo{{ i }}" class="w-full"
              placeholder="Contact No" />
          </td>
          <td>
            <input type="text" pInputText [(ngModel)]="guest.additionalContactNo" name="additionalContactNo{{ i }}"
              class="w-full" placeholder="Additional Contact No" />
          </td>
          <td>
            <textarea pInputTextarea [(ngModel)]="guest.pickupAddress" name="pickupAddress{{ i }}"
              class="w-full p-inputtext" placeholder="Pickup Address"></textarea>
          </td>
          <td>
            <textarea pInputTextarea [(ngModel)]="guest.dropAddress" name="dropAddress{{ i }}"
              class="w-full p-inputtext" placeholder="Drop Address"></textarea>
          </td>
          <td>
            <textarea pInputTextarea [(ngModel)]="guest.remarks" name="remarks{{ i }}" class="w-full p-inputtext"
              placeholder="Remarks"></textarea>
          </td>
          <td class="text-center">
            <button pButton icon="pi pi-trash" class="p-button-danger" (click)="removeGuest(i)"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <button pButton type="button" label="Add Guest" icon="pi pi-plus" class="mt-4 p-button-success"
      (click)="addGuest()"></button>
  </div>

  <!-- Action Buttons -->
  <div class="flex justify-end mt-6 gap-4">
    <button pButton type="button" label="Close" class="p-button-secondary"></button>
    <button pButton type="button" label="Save" class="p-button-success" (click)="saveBooking()"></button>
  </div>
</div>
