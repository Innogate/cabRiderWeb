<!-- Monthly Invoice Management UI -->
<div
  class="w-full mt-6 px-4 py-6 sm:px-6 lg:px-8 bg-white border border-blue-200 rounded-2xl shadow-md"
>
  <!-- Header Section -->
  <div
    class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4"
  >
    <h1
      class="text-2xl sm:text-3xl font-bold text-blue-900 flex items-center gap-2"
    >
      <i class="pi pi-file-invoice text-blue-600 text-xl sm:text-2xl"></i>
      Monthly Invoice List
    </h1>
    <button
      pButton
      label="Add Invoice"
      icon="pi pi-plus"
      class="p-button-success p-button-rounded shadow-sm hover:scale-[1.03] transition"
      (click)="goToAdd()"
    ></button>
  </div>

  <!-- Filters Section -->
  <div
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 bg-blue-50 p-5 rounded-xl border border-blue-100 mb-6"
  >
    <!-- Company -->
    <div>
      <label for="company" class="block text-sm font-medium text-gray-700 mb-1"
        >Company</label
      >
      <p-dropdown
        [options]="companies"
        [(ngModel)]="selectedCompany"
        optionLabel="Name"
        optionValue="Id"
        placeholder="Select Company"
        [style.width.%]="100"
      >
      </p-dropdown>
    </div>

    <!-- Show Filter -->
    <div>
      <label for="show" class="block text-sm font-medium text-gray-700 mb-1"
        >Show</label
      >
      <p-dropdown
        inputId="show"
        [options]="show"
        [(ngModel)]="selectedShow"
        placeholder="Filter"
        [showClear]="true"
        class="w-full"
      ></p-dropdown>
    </div>

    <!-- Search -->
    <div class="lg:col-span-2">
      <label for="search" class="block text-sm font-medium text-gray-700 mb-1"
        >Search</label
      >
      <div class="flex flex-col sm:flex-row items-stretch gap-2">
        <span class="p-input-icon-left w-full">
          <input
            id="search"
            pInputText
            type="text"
            [(ngModel)]="searchText"
            placeholder="Search by invoice no, party, city..."
            class="w-full"
          />
        </span>
        <div class="flex gap-2">
          <button
            pButton
            icon="pi pi-search"
            class="p-button-sm p-button-info p-button-rounded"
            (click)="searchInvoices()"
            pTooltip="Search"
          ></button>
          <button
            pButton
            icon="pi pi-refresh"
            class="p-button-sm p-button-secondary p-button-rounded"
            (click)="resetFilters()"
            pTooltip="Reset Filters"
          ></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Invoice Table -->
  <div class="overflow-x-auto">
    <p-table
      #table
      [value]="invoices"
      [loading]="tableLading"
      [paginator]="true"
      [rows]="dataCount"
      [responsiveLayout]="'scroll'"
      [showGridlines]="true"
      [stripedRows]="true"
      [scrollable]="true"
      scrollHeight="flex"
      scrollDirection="both"
      [totalRecords]="totalRecords"
      (onLazyLoad)="loadData($event)"
      [lazy]="isLazyLoad"
      class="p-datatable-sm text-sm font-sans"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    >
      <ng-template pTemplate="header">
        <tr class="bg-blue-100 text-blue-900 text-sm font-semibold">
          <th pResizableColumn>Sl. No.</th>
          <th pResizableColumn>Branch</th>
          <th pResizableColumn>Invoice No.</th>
          <th pResizableColumn>Date</th>
          <th pResizableColumn>Party</th>
          <th pResizableColumn>City</th>
          <th pResizableColumn>Gross</th>
          <th pResizableColumn>Taxable</th>
          <th pResizableColumn>CGST</th>
          <th pResizableColumn>SGST</th>
          <th pResizableColumn>IGST</th>
          <th pResizableColumn>Non-Taxable</th>
          <th pResizableColumn>Net</th>
          <th pResizableColumn>Received</th>
          <th pResizableColumn>Due</th>
          <th class="text-center">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-invoice let-rowIndex="rowIndex">
        <tr class="text-gray-800 hover:bg-blue-50 transition text-sm">
          <td>{{ (table.first || 0) + rowIndex + 1 }}</td>
          <!-- Replace static slNo with calculated serial number -->
          <td>{{ invoice.BranchShortName }}</td>
          <td>{{ invoice.BillNo }}</td>
          <td>{{ invoice.BillDate }}</td>
          <td>{{ invoice.PartyName}}</td>
          <td>{{ invoice.CityName }}</td>
          <td>{{ invoice.GrossAmount }}</td>
          <td>
            <div
              class="inline-flex items-center gap-2 px-3 py-1 rounded-md bg-blue-100 text-blue-700 text-sm border border-blue-300 cursor-pointer hover:shadow-md"
              (click)="openInvoiceDetails(invoice)"
            >
              <i class="pi pi-eye text-blue-700"></i>
              <span>{{ invoice.OtherCharges ?? "0" }}</span>
            </div>
          </td>
          <td>{{ invoice.CGST }}</td>
          <td>{{ invoice.SGST }}</td>
          <td>{{ invoice.IGST }}</td>
          <td>
            <div
              class="inline-flex items-center gap-2 px-3 py-1 rounded-md bg-green-100 text-green-700 text-sm border border-green-300 cursor-pointer hover:shadow-md"
              (click)="openInvoiceDetails(invoice)"
            >
              <i class="pi pi-eye text-green-700"></i>
              <span>{{ invoice.OtherCharges2 ?? "0" }}</span>
            </div>
          </td>
          <td>{{ invoice.NetAmount }}</td>
          <td>
            <p-tag [value]="invoice.Advance ?? '0'" severity="warning"></p-tag>
          </td>
          <td>
            <p-tag
              [value]="
                ((invoice.NetAmount || 0) - (invoice.Advance || 0)).toString()
              "
              severity="danger"
            ></p-tag>
          </td>
          <td>
            <div class="flex justify-center gap-2">
              <button
                pButton
                pTooltip="Invoice"
                icon="pi pi-eye"
                class="p-button-sm p-button-rounded p-button-info"
              ></button>
              <button
                pButton
                icon="pi pi-pencil"
                pTooltip="Update"
                class="p-button-sm p-button-rounded p-button-warning"
                (click)="editInvoice(invoice)"
              ></button>
              <button
                pButton
                pTooltip="Delete"
                icon="pi pi-trash"
                class="p-button-sm p-button-rounded p-button-danger"
              ></button>
            </div>

            <div class="flex justify-center gap-2 mt-3">
              <button
                pButton
                pTooltip="Payment Received"
                (click)="openDialog()"
                icon="pi pi-wallet"
                class="p-button-sm p-button-rounded p-button-success"
              ></button>
              <button
                pButton
                pTooltip="XML"
                icon="pi pi-code"
                class="p-button-sm p-button-rounded p-button-secondary"
              ></button>
              <button
                pButton
                pTooltip="PDF"
                icon="pi pi-file-pdf"
                class="p-button-sm p-button-rounded p-button-help"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<app-invoice-eyes-show
  *ngIf="showInvoiceDetails"
  [selectedInvoice]="selectedInvoice"
  [id]="invoices"
  (close)="showInvoiceDetails = false"
></app-invoice-eyes-show>

<!-- payment-received.component.html -->
<p-dialog
  header="Payment Received"
  [(visible)]="showDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '90vw', marginTop: '0px' }"
  [contentStyle]="{ padding: '0', margin: '0' }"
  [baseZIndex]="10000"
  styleClass="rounded-xl shadow-2xl overflow-hidden m-2 p-2"
>
  <!-- Dialog Content -->
  <div class="p-4">
    <!-- Top Bar (Dropdown + Search) -->
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 bg-blue-50 p-5 rounded-xl border border-blue-100 mb-6"
    >
      <!-- Show Filter (Left Side) -->
      <div class="lg:col-span-1">
        <label for="show" class="block text-sm font-medium text-gray-700 mb-1"
          >Show</label
        >
        <p-dropdown
          inputId="show"
          [options]="show"
          [(ngModel)]="selectedShow"
          placeholder="Filter"
          [showClear]="true"
          class="w-full"
        ></p-dropdown>
      </div>

      <!-- Empty columns to push search to right -->
      <div class="lg:col-span-2 hidden lg:block"></div>

      <!-- Search (Right Side) -->
      <div class="lg:col-span-1 flex flex-col justify-end">
        <label for="search" class="block text-sm font-medium text-gray-700 mb-1"
          >Search</label
        >
        <div class="flex items-center gap-2">
          <span class="p-input-icon-left w-full">
            <input
              id="search"
              pInputText
              type="text"
              [(ngModel)]="searchText"
              placeholder="Search by Sno , Amount..."
              class="w-full"
            />
          </span>
          <button
            pButton
            icon="pi pi-search"
            class="p-button-sm p-button-info p-button-rounded"
            (click)="searchInvoices()"
            pTooltip="Search"
          ></button>
        </div>
      </div>
    </div>

    <!-- Scrollable Table -->
    <p-table
      [value]="payments"
      scrollable
      scrollHeight="250px"
      class="p-datatable-sm rounded-xl overflow-hidden shadow"
      [style]="{ minWidth: '100%' }"
      [rows]="rows"
      [globalFilterFields]="['voucherNo', 'amount']"
      [responsiveLayout]="'scroll'"
      emptyMessage="No data available"
    >
      <ng-template pTemplate="header">
        <tr class="bg-blue-700 text-white text-center text-sm">
          <th><i class="pi pi-tags text-yellow-300 mr-1"></i></th>
          <th><i class="pi pi-hashtag text-purple-400 mr-1"></i> SNo</th>
          <th><i class="pi pi-file text-pink-400 mr-1"></i> Voucher No</th>
          <th><i class="pi pi-dollar text-green-400 mr-1"></i> Amount</th>
          <th>
            <i class="pi pi-credit-card text-indigo-400 mr-1"></i> Payment
            Received
          </th>
          <th>
            <i class="pi pi-percentage text-lime-400 mr-1"></i> TDS Amount
          </th>
          <th><i class="pi pi-tags text-violet-400 mr-1"></i> Discount</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row let-i="rowIndex">
        <tr
          class="text-center text-sm hover:bg-blue-100 transition duration-200"
        >
          <td></td>
          <td class="font-semibold">{{ i + 1 }}</td>
          <td>{{ row.voucherNo }}</td>
          <td class="text-green-600 font-bold">₹ {{ row.amount }}</td>
          <td class="text-blue-700 font-semibold">
            ₹ {{ row.paymentReceived }}
          </td>
          <td class="text-yellow-600">₹ {{ row.tdsAmount }}</td>
          <td class="text-pink-600">₹ {{ row.discountAmount }}</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-dialog>
